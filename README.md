# XLORM - Lightweight Database ORM Framework for Go Language

[中文版](README_ZH.md "Visit Chinese Version")

[English](README.md "Access English Version")

## Introduction

XLORM is a high-performance, easy-to-use lightweight ORM framework designed specifically for Go language, supporting MySQL databases. It provides comprehensive CRUD operations, transaction management, batch processing, query builders, cache support, and built-in logging and performance monitoring modules, helping developers quickly build robust database applications.

**XLORM is generated by Windsurf AI command generation and code-reviewed by DeepSeek R1 for performance optimization suggestions.**

## Key Features

- **Complete CRUD Support**: Simplify data operations, supporting struct and map data types
- **Transaction Management**: Provide atomic operations and nested transaction support
- **Batch Operation Optimization**: Efficiently handle large-scale data insertion/updates
- **Query Builder**: Chain calls generate safe SQL, preventing injection
- **Cache Support**: Built-in sharded lock cache, improving high-frequency query performance
- **Logging and Monitoring**: Asynchronous log recording, slow query alerts, connection pool statistics
- **Connection Pool Management**: Support connection health checks, timeout control, connection reuse

### 1. High-Performance Design
- Asynchronous performance metrics collection
- Connection pool management
- Batch operation optimization
- Caching mechanism (struct field caching, placeholder caching)

### 2. Flexible Database Operations
- Support for various database operations (CRUD)
- Transaction processing
- Dynamic query building
- Field mapping and conversion

### 3. Logging System
- Structured log recording
- Log rotation
- Configurable log levels
- Asynchronous log processing

### 4. Security
- SQL injection protection
- Field escaping
- Secure parameter binding
- Connection timeout control

### 5. Debugging Support
- Detailed debug mode
- Performance metrics tracking
- Slow query monitoring
- Detailed system runtime status reporting

### 6. Dynamic Configuration
- Runtime configuration modification
- Hot update of connection pool parameters
- Flexible log level adjustment

## Performance Comparison with GORM/XORM

### 1. GORM
#### Advantages
- Rich features, supporting model associations, hooks, migrations, etc.
- Active community, comprehensive documentation, rich plugin ecosystem

#### Disadvantages
- Heavy use of reflection, relatively lower performance, especially in complex queries or high-frequency operations
- Weak logging and metrics capabilities, requires external libraries (e.g., Prometheus)

### 2. XORM
#### Advantages
- Better performance than GORM, supports read/write separation and cache optimization
- More flexible condition builder

#### Disadvantages
- Less optimized async processing and batch operations compared to XLORM
- Logging and monitoring features require manual integration

### 3. XLORM
#### Performance Highlights
- **Batch Operations**: Reduce network round trips and lock contention through transaction batch commits
- **Cache Design**: Sharded LRU cache improves high-frequency query efficiency
- **Object Pooling**: Reduces GC pressure, suitable for high concurrency scenarios

#### Applicable Scenarios
- High-performance batch writes (e.g., log ingestion, data synchronization)
- Projects with high requirements for custom logging and monitoring

### Summary

| Dimension   | GORM                | XORM                | XLORM               |
|-------------|---------------------|---------------------|---------------------|
| Features    | Rich (associations) | Medium (R/W split)  | Basic (CRUD/batch)  |
| Performance | Low                 | Medium              | High (batch/cache)  |
| Security    | Medium              | Medium              | High (injection protection) |
| Usability   | High (docs)         | Medium              | High (docs)         |
| Use Cases   | Complex logic       | General OLTP        | High-frequency batch writes |

### Recommendations
- Choose **GORM** if you need advanced features (associations, migrations)
- Choose **XORM** for balanced performance and features
- Choose **XLORM** for ultimate performance in simple scenarios (e.g., data synchronization)

#### Benchmark reports, module descriptions, and other details can be found in the md directory.

## Installation

```bash
go get -u github.com/windsurf/xlorm
```

## Quick Start

```go
import (
    "github.com/windsurf/xlorm/db"
    "os"
    "time"
)

// Configure database connection
config := &db.Config{
    DBName:            "master",
    Driver:            "MySQL",
    Host:              os.Getenv("DB_HOST"),
    Port:              3306,
    Username:          os.Getenv("DB_USERNAME"),
    Password:          os.Getenv("DB_PASSWORD"),
    Database:          "myapp",
    
    // Connection pool configuration
    MaxOpenConns:      50,
    MaxIdleConns:      10,
    ConnMaxLifetime:   30 * time.Minute,
    
    // Timeout configuration
    ConnTimeout:       5 * time.Second,
    ReadTimeout:       3 * time.Second,
    WriteTimeout:      3 * time.Second,
    SlowQueryTime:     200 * time.Millisecond,
    
    // Logging configuration
    LogLevel:          "warn",
    LogDir:            "./logs",
    Debug:             false,
    EnablePoolStats:   true,
}

// Create database connection
xdb, err := db.Open(config)
if err != nil {
    // Handle connection error
}
defer xdb.Close()
```

## Configuration Options

XLORM provides rich and flexible configuration options, each carefully designed to meet different scenario requirements.

### Database Connection Configuration

| Configuration | Type | Default | Description | Recommended Setting |
|--------------|------|---------|-------------|---------------------|
| `DBName` | `string` | `""` | Database alias for distinguishing different database instances | Set a meaningful name |
| `Driver` | `string` | `"MySQL"` | Database driver type | Currently only supports MySQL |
| `Host` | `string` | `"localhost"` | Database server address | Use actual server address in production |
| `Port` | `int` | `3306` | Database server port | MySQL default is 3306 |
| `Username` | `string` | `""` | Database login username | Use user with minimal privileges |
| `Password` | `string` | `""` | Database login password | Recommend using environment variables |
| `Database` | `string` | `""` | Specific database name to connect | Required |

### Connection Pool Configuration

| Configuration | Type | Default | Description | Performance Suggestions |
|--------------|------|---------|-------------|-------------------------|
| `MaxOpenConns` | `int` | `100` | Maximum open connections | Adjust based on concurrent business volume |
| `MaxIdleConns` | `int` | `20` | Maximum idle connections | Balance memory usage and connection reuse |
| `ConnMaxLifetime` | `time.Duration` | `30 * time.Minute` | Maximum connection lifetime | Prevent long connection resource leaks |
| `ConnMaxIdleTime` | `time.Duration` | `10 * time.Minute` | Maximum idle connection retention time | Control connection recycling frequency |

### Timeout and Security Configuration

| Configuration | Type | Default | Description | Security Recommendations |
|--------------|------|---------|-------------|--------------------------|
| `ConnTimeout` | `time.Duration` | `5 * time.Second` | Connection establishment timeout | Adjust based on network conditions |
| `ReadTimeout` | `time.Duration` | `3 * time.Second` | Read data timeout | Avoid long-time blocking |
| `WriteTimeout` | `time.Duration` | `3 * time.Second` | Write data timeout | Prevent write operations from hanging |
| `SlowQueryTime` | `time.Duration` | `200 * time.Millisecond` | Slow query threshold | Set reasonably to detect performance issues |

### Logging and Debugging Configuration

| Configuration | Type | Default | Description | Usage Recommendations |
|--------------|------|---------|-------------|------------------------|
| `LogLevel` | `string` | `"warn"` | Log level | Recommend `warn`/`error` in production |
| `Debug` | `bool` | `false` | Debug mode | Enable during development, disable in production |
| `LogDir` | `string` | `"./logs"` | Log storage directory | Ensure directory is writable |
| `LogBufferSize` | `int` | `5000` | Log buffer size | Adjust based on log volume |
| `EnablePoolStats` | `bool` | `false` | Enable connection pool statistics | Enable during performance monitoring |

### Advanced Configuration Considerations

1. **Security**:
   - Avoid hardcoding sensitive information in code
   - Use environment variables to manage database credentials
   - Limit connection pool size to prevent resource exhaustion

2. **Performance Optimization**:
   - Adjust `MaxOpenConns` and `MaxIdleConns` based on actual business scenarios
   - Set timeout times reasonably to prevent resource waste
   - Use `SlowQueryTime` to track performance bottlenecks

3. **Log Management**:
   - Recommend using `warn` or `error` level in production
   - Regularly clean and backup log files
   - Monitor log buffer usage

### Configuration Example

```go
config := &db.Config{
    DBName:            "master",
    Driver:            "MySQL",
    Host:              os.Getenv("DB_HOST"),
    Port:              3306,
    Username:          os.Getenv("DB_USERNAME"),
    Password:          os.Getenv("DB_PASSWORD"),
    Database:          "myapp",
    
    // Connection pool configuration
    MaxOpenConns:      50,
    MaxIdleConns:      10,
    ConnMaxLifetime:   30 * time.Minute,
    
    // Timeout configuration
    ConnTimeout:       5 * time.Second,
    ReadTimeout:       3 * time.Second,
    WriteTimeout:      3 * time.Second,
    SlowQueryTime:     200 * time.Millisecond,
    
    // Logging configuration
    LogLevel:          "warn",
    LogDir:            "./logs",
    Debug:             false,
    EnablePoolStats:   true,
}
```

**Tip**: Always adjust configuration parameters based on specific business scenarios and performance requirements.

## License

[MIT License]
